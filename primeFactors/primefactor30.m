N = 30;

dft2 = dftmtx(2);
dft15 = dftmtx(15);

t = complex(65*cos(2*pi*(1:N)/1.8),-30*sin(2*pi*(1:N)/6.3));

f_matlab = fft(t);

figure; 
subplot(2,1,1); plot(abs(t),'-*'); 
subplot(2,1,2); plot(abs(f_matlab),'-*');

%%
f1 = zeros(2,15);
f1(:,1) = dft2 * [t(0+1); t(15+1);];
f1(:,2) = dft2 * [t(16+1); t(1+1);];
f1(:,3) = dft2 * [t(2+1); t(17+1);];
f1(:,4) = dft2 * [t(18+1); t(3+1);];
f1(:,5) = dft2 * [t(4+1); t(19+1);];
f1(:,6) = dft2 * [t(20+1); t(5+1);];
f1(:,7) = dft2 * [t(6+1); t(21+1);];
f1(:,8) = dft2 * [t(22+1); t(7+1);];
f1(:,9) = dft2 * [t(8+1); t(23+1);];
f1(:,10) = dft2 * [t(24+1); t(9+1);];
f1(:,11) = dft2 * [t(10+1); t(25+1);];
f1(:,12) = dft2 * [t(26+1); t(11+1);];
f1(:,13) = dft2 * [t(12+1); t(27+1);];
f1(:,14) = dft2 * [t(28+1); t(13+1);];
f1(:,15) = dft2 * [t(14+1); t(29+1);];

f2 = zeros(2,15);
f2(1,:) = dft15 * f1(1,:).';
f2(2,:) = dft15 * f1(2,:).';

f3 = [ ...
    f2(1,1) f2(2,9) f2(1,2) f2(2,10) f2(1,3) f2(2,11) ...
    f2(1,4) f2(2,12) f2(1,5) f2(2,13) f2(1,6) f2(2,14) ...
    f2(1,7) f2(2,15) f2(1,8) f2(2,1) f2(1,9) f2(2,2) ...
    f2(1,10) f2(2,3) f2(1,11) f2(2,4) f2(1,12) f2(2,5) ...
    f2(1,13) f2(2,6) f2(1,14) f2(2,7) f2(1,15) f2(2,8) ];

figure; 
subplot(3,1,1); plot(abs(f3),'-*'); 
subplot(3,1,2); plot(abs(f_matlab),'-*');
subplot(3,1,3); plot(abs(f3-f_matlab),'-*');

%%
f12 = zeros(2, 15);
f12(1,:) = (dft15 * ([ ...
    t(0+1)+t(15+1); t(16+1)+t(1+1); t(2+1)+t(17+1); ...
    t(18+1)+t(3+1); t(4+1)+t(19+1); t(20+1)+t(5+1); ...
    t(6+1)+t(21+1); t(22+1)+t(7+1); t(8+1)+t(23+1); ...
    t(24+1)+t(9+1); t(10+1)+t(25+1); t(26+1)+t(11+1); ...
    t(12+1)+t(27+1); t(28+1)+t(13+1); t(14+1)+t(29+1); ...
    ]));
f12(2,:) = (dft15 * ([ ...
    t(0+1)-t(15+1); t(16+1)-t(1+1); t(2+1)-t(17+1); ...
    t(18+1)-t(3+1); t(4+1)-t(19+1); t(20+1)-t(5+1); ...
    t(6+1)-t(21+1); t(22+1)-t(7+1); t(8+1)-t(23+1); ...
    t(24+1)-t(9+1); t(10+1)-t(25+1); t(26+1)-t(11+1); ...
    t(12+1)-t(27+1); t(28+1)-t(13+1); t(14+1)-t(29+1); ...
    ]));
f13 = [ ...
    f12(1,1) f12(2,9) f12(1,2) f12(2,10) f12(1,3) f12(2,11) ...
    f12(1,4) f12(2,12) f12(1,5) f12(2,13) f12(1,6) f12(2,14) ...
    f12(1,7) f12(2,15) f12(1,8) f12(2,1) f12(1,9) f12(2,2) ...
    f12(1,10) f12(2,3) f12(1,11) f12(2,4) f12(1,12) f12(2,5) ...
    f12(1,13) f12(2,6) f12(1,14) f12(2,7) f12(1,15) f12(2,8) ];
figure; 
subplot(3,1,1); plot(abs(f3),'-*'); 
subplot(3,1,2); plot(abs(f13),'-*');
subplot(3,1,3); plot(abs(f3-f13),'-*');

%%

dft15_real = [ ...
256 256 256 256 256 256 256 256 256 256 256 256 256 256 256 ; ... 
256 234 171 79 -27 -128 -207 -250 -250 -207 -128 -27 79 171 234 ; ... 
256 171 -27 -207 -250 -128 79 234 234 79 -128 -250 -207 -27 171 ; ... 
256 79 -207 -207 79 256 79 -207 -207 79 256 79 -207 -207 79 ; ... 
256 -27 -250 79 234 -128 -207 171 171 -207 -128 234 79 -250 -27 ; ... 
256 -128 -128 256 -128 -128 256 -128 -128 256 -128 -128 256 -128 -128 ; ... 
256 -207 79 79 -207 256 -207 79 79 -207 256 -207 79 79 -207 ; ... 
256 -250 234 -207 171 -128 79 -27 -27 79 -128 171 -207 234 -250 ; ... 
256 -250 234 -207 171 -128 79 -27 -27 79 -128 171 -207 234 -250 ; ... 
256 -207 79 79 -207 256 -207 79 79 -207 256 -207 79 79 -207 ; ... 
256 -128 -128 256 -128 -128 256 -128 -128 256 -128 -128 256 -128 -128 ; ... 
256 -27 -250 79 234 -128 -207 171 171 -207 -128 234 79 -250 -27 ; ... 
256 79 -207 -207 79 256 79 -207 -207 79 256 79 -207 -207 79 ; ... 
256 171 -27 -207 -250 -128 79 234 234 79 -128 -250 -207 -27 171 ; ... 
256 234 171 79 -27 -128 -207 -250 -250 -207 -128 -27 79 171 234 ; ... 
];
dft15_imag = [ ...
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 ; ... 
0 -104 -190 -243 -255 -222 -150 -53 53 150 222 255 243 190 104 ; ... 
0 -190 -255 -150 53 222 243 104 -104 -243 -222 -53 150 255 190 ; ... 
0 -243 -150 150 243 0 -243 -150 150 243 0 -243 -150 150 243 ; ... 
0 -255 53 243 -104 -222 150 190 -190 -150 222 104 -243 -53 255 ; ... 
0 -222 222 0 -222 222 0 -222 222 0 -222 222 0 -222 222 ; ... 
0 -150 243 -243 150 0 -150 243 -243 150 0 -150 243 -243 150 ; ... 
0 -53 104 -150 190 -222 243 -255 255 -243 222 -190 150 -104 53 ; ... 
0 53 -104 150 -190 222 -243 255 -255 243 -222 190 -150 104 -53 ; ... 
0 150 -243 243 -150 0 150 -243 243 -150 0 150 -243 243 -150 ; ... 
0 222 -222 0 222 -222 0 222 -222 0 222 -222 0 222 -222 ; ... 
0 255 -53 -243 104 222 -150 -190 190 150 -222 -104 243 53 -255 ; ... 
0 243 150 -150 -243 0 243 150 -150 -243 0 243 150 -150 -243 ; ... 
0 190 255 150 -53 -222 -243 -104 104 243 222 53 -150 -255 -190 ; ... 
0 104 190 243 255 222 150 53 -53 -150 -222 -255 -243 -190 -104 ; ... 
];
dft15_int8 = complex(dft15_real, dft15_imag);
f22 = zeros(2, 15);
f22(1,:) = (double(dft15_int8) * ([ ...
    t(0+1)+t(15+1); t(16+1)+t(1+1); t(2+1)+t(17+1); ...
    t(18+1)+t(3+1); t(4+1)+t(19+1); t(20+1)+t(5+1); ...
    t(6+1)+t(21+1); t(22+1)+t(7+1); t(8+1)+t(23+1); ...
    t(24+1)+t(9+1); t(10+1)+t(25+1); t(26+1)+t(11+1); ...
    t(12+1)+t(27+1); t(28+1)+t(13+1); t(14+1)+t(29+1); ...
    ]))/256;
f22(2,:) = (double(dft15_int8) * ([ ...
    t(0+1)-t(15+1); t(16+1)-t(1+1); t(2+1)-t(17+1); ...
    t(18+1)-t(3+1); t(4+1)-t(19+1); t(20+1)-t(5+1); ...
    t(6+1)-t(21+1); t(22+1)-t(7+1); t(8+1)-t(23+1); ...
    t(24+1)-t(9+1); t(10+1)-t(25+1); t(26+1)-t(11+1); ...
    t(12+1)-t(27+1); t(28+1)-t(13+1); t(14+1)-t(29+1); ...
    ]))/256;
f23 = [ ...
    f22(1,1) f22(2,9) f22(1,2) f22(2,10) f22(1,3) f22(2,11) ...
    f22(1,4) f22(2,12) f22(1,5) f22(2,13) f22(1,6) f22(2,14) ...
    f22(1,7) f22(2,15) f22(1,8) f22(2,1) f22(1,9) f22(2,2) ...
    f22(1,10) f22(2,3) f22(1,11) f22(2,4) f22(1,12) f22(2,5) ...
    f22(1,13) f22(2,6) f22(1,14) f22(2,7) f22(1,15) f22(2,8)];
figure; 
subplot(3,1,1); plot(abs(f3),'-*'); 
subplot(3,1,2); plot(abs(f23),'-*');
subplot(3,1,3); plot(abs(f3-f23),'-*');

%%
f31 = ([ ...
    t(0+1)+t(15+1); t(16+1)+t(1+1); t(2+1)+t(17+1); ...
    t(18+1)+t(3+1); t(4+1)+t(19+1); t(20+1)+t(5+1); ...
    t(6+1)+t(21+1); t(22+1)+t(7+1); t(8+1)+t(23+1); ...
    t(24+1)+t(9+1); t(10+1)+t(25+1); t(26+1)+t(11+1); ...
    t(12+1)+t(27+1); t(28+1)+t(13+1); t(14+1)+t(29+1); ...
    ]);
f32 = ([ ...
    t(0+1)-t(15+1); t(16+1)-t(1+1); t(2+1)-t(17+1); ...
    t(18+1)-t(3+1); t(4+1)-t(19+1); t(20+1)-t(5+1); ...
    t(6+1)-t(21+1); t(22+1)-t(7+1); t(8+1)-t(23+1); ...
    t(24+1)-t(9+1); t(10+1)-t(25+1); t(26+1)-t(11+1); ...
    t(12+1)-t(27+1); t(28+1)-t(13+1); t(14+1)-t(29+1); ...
    ]);
f33 = zeros(1,30);
f33(1) = dft15_int8(1,:)/256 * f31;
f33(2) = dft15_int8(9,:)/256 * f32;
f33(3) = dft15_int8(2,:)/256 * f31;
f33(4) = dft15_int8(10,:)/256 * f32;
f33(5) = dft15_int8(3,:)/256 * f31;
f33(6) = dft15_int8(11,:)/256 * f32;
f33(7) = dft15_int8(4,:)/256 * f31;
f33(8) = dft15_int8(12,:)/256 * f32;
f33(9) = dft15_int8(5,:)/256 * f31;
f33(10) = dft15_int8(13,:)/256 * f32;
f33(11) = dft15_int8(6,:)/256 * f31;
f33(12) = dft15_int8(14,:)/256 * f32;
f33(13) = dft15_int8(7,:)/256 * f31;
f33(14) = dft15_int8(15,:)/256 * f32;
f33(15) = dft15_int8(8,:)/256 * f31;
f33(16) = dft15_int8(1,:)/256 * f32;
f33(17) = dft15_int8(9,:)/256 * f31;
f33(18) = dft15_int8(2,:)/256 * f32;
f33(19) = dft15_int8(10,:)/256 * f31;
f33(20) = dft15_int8(3,:)/256 * f32;
f33(21) = dft15_int8(11,:)/256 * f31;
f33(22) = dft15_int8(4,:)/256 * f32;
f33(23) = dft15_int8(12,:)/256 * f31;
f33(24) = dft15_int8(5,:)/256 * f32;
f33(25) = dft15_int8(13,:)/256 * f31;
f33(26) = dft15_int8(6,:)/256 * f32;
f33(27) = dft15_int8(14,:)/256 * f31;
f33(28) = dft15_int8(7,:)/256 * f32;
f33(29) = dft15_int8(15,:)/256 * f31;
f33(30) = dft15_int8(8,:)/256 * f32;

figure; 
subplot(3,1,1); plot(abs(f3),'-*'); 
subplot(3,1,2); plot(abs(f33),'-*');
subplot(3,1,3); plot(abs(f3-f33),'-*');
%%
dft15_reordered = int16(zeros(30,15));
dft15_reordered(1,:) = int16(dft15_int8(1,:));
dft15_reordered(2,:) = int16(dft15_int8(9,:));
dft15_reordered(3,:) = int16(dft15_int8(2,:));
dft15_reordered(4,:) = int16(dft15_int8(10,:));
dft15_reordered(5,:) = int16(dft15_int8(3,:));
dft15_reordered(6,:) = int16(dft15_int8(11,:));
dft15_reordered(7,:) = int16(dft15_int8(4,:));
dft15_reordered(8,:) = int16(dft15_int8(12,:));
dft15_reordered(9,:) = int16(dft15_int8(5,:));
dft15_reordered(10,:) = int16(dft15_int8(13,:));
dft15_reordered(11,:) = int16(dft15_int8(6,:));
dft15_reordered(12,:) = int16(dft15_int8(14,:));
dft15_reordered(13,:) = int16(dft15_int8(7,:));
dft15_reordered(14,:) = int16(dft15_int8(15,:));
dft15_reordered(15,:) = int16(dft15_int8(8,:));
dft15_reordered(16,:) = int16(dft15_int8(1,:));
dft15_reordered(17,:) = int16(dft15_int8(9,:));
dft15_reordered(18,:) = int16(dft15_int8(2,:));
dft15_reordered(19,:) = int16(dft15_int8(10,:));
dft15_reordered(20,:) = int16(dft15_int8(3,:));
dft15_reordered(21,:) = int16(dft15_int8(11,:));
dft15_reordered(22,:) = int16(dft15_int8(4,:));
dft15_reordered(23,:) = int16(dft15_int8(12,:));
dft15_reordered(24,:) = int16(dft15_int8(5,:));
dft15_reordered(25,:) = int16(dft15_int8(13,:));
dft15_reordered(26,:) = int16(dft15_int8(6,:));
dft15_reordered(27,:) = int16(dft15_int8(14,:));
dft15_reordered(28,:) = int16(dft15_int8(7,:));
dft15_reordered(29,:) = int16(dft15_int8(15,:));
dft15_reordered(30,:) = int16(dft15_int8(8,:));

dft15_index = ...
  [1 1 1 1 1 1 1 1 1 1 1 1 1 1 1;
   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15;
   1 3 5 7 9 11 13 15 2 4 6 8 10 12 14;
   1 4 7 10 13 1 4 7 10 13 1 4 7 10 13;
   1 5 9 13 2 6 10 14 3 7 11 15 4 8 12;
   1 6 11 1 6 11 1 6 11 1 6 11 1 6 11;
   1 7 13 4 10 1 7 13 4 10 1 7 13 4 10;
   1 8 15 7 14 6 13 5 12 4 11 3 10 2 9;
   1 9 2 10 3 11 4 12 5 13 6 14 7 15 8;
   1 10 4 13 7 1 10 4 13 7 1 10 4 13 7;
   1 11 6 1 11 6 1 11 6 1 11 6 1 11 6;
   1 12 8 4 15 11 7 3 14 10 6 2 13 9 5;
   1 13 10 7 4 1 13 10 7 4 1 13 10 7 4;
   1 14 12 10 8 6 4 2 15 13 11 9 7 5 3;
   1 15 14 13 12 11 10 9 8 7 6 5 4 3 2;
   1 1 1 1 1 1 1 1 1 1 1 1 1 1 1;
   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15;
   1 3 5 7 9 11 13 15 2 4 6 8 10 12 14;
   1 4 7 10 13 1 4 7 10 13 1 4 7 10 13;
   1 5 9 13 2 6 10 14 3 7 11 15 4 8 12;
   1 6 11 1 6 11 1 6 11 1 6 11 1 6 11;
   1 7 13 4 10 1 7 13 4 10 1 7 13 4 10;
   1 8 15 7 14 6 13 5 12 4 11 3 10 2 9;
   1 9 2 10 3 11 4 12 5 13 6 14 7 15 8;
   1 10 4 13 7 1 10 4 13 7 1 10 4 13 7;
   1 11 6 1 11 6 1 11 6 1 11 6 1 11 6;
   1 12 8 4 15 11 7 3 14 10 6 2 13 9 5;
   1 13 10 7 4 1 13 10 7 4 1 13 10 7 4;
   1 14 12 10 8 6 4 2 15 13 11 9 7 5 3;
   1 15 14 13 12 11 10 9 8 7 6 5 4 3 2];

dft15_index_lookup = ...
  [256 0;
   -250 53;
   234 -104;
   -207 150;
   171 -190;
   -128 222;
   79 -243;
   -27 255;
   -27 -255;
   79 243;
   -128 -222;
   171 190;
   -207 -150;
   234 104;
   -250 -53];

%%
f43 = zeros(2,15);
f43(:,1) = kernel(f31(1),0,1,1) ...
    + kernel(f31(2),0,1,1) ...
    + kernel(f31(3),0,1,1) ...
    + kernel(f31(4),0,1,1) ...
    + kernel(f31(5),0,1,1) ...
    + kernel(f31(6),0,1,1) ...
    + kernel(f31(7),0,1,1) ...
    + kernel(f31(8),0,1,1) ...
    + kernel(f31(9),0,1,1) ...
    + kernel(f31(10),0,1,1) ...
    + kernel(f31(11),0,1,1) ...
    + kernel(f31(12),0,1,1) ...
    + kernel(f31(13),0,1,1) ...
    + kernel(f31(14),0,1,1) ...
    + kernel(f31(15),0,1,1);
    
f43(:,2) = kernel(f32(1),0,1,1) ...
    + kernel(f32(2),f32(15),2,1) ...
	+ kernel(f32(3),f32(14),3,1) ...
	+ kernel(f32(4),f32(13),4,1) ...
	+ kernel(f32(5),f32(12),5,1) ...
	+ kernel(f32(6),f32(11),6,1) ...
	+ kernel(f32(7),f32(10),7,1) ...
	+ kernel(f32(8),f32(9),8,1)
f43(:,3) = kernel(f31(1),0,1,1) ...
    + kernel(f31(2),f31(15),3,1) ...
	+ kernel(f31(3),f31(14),5,1) ...
	+ kernel(f31(4),f31(13),7,1) ...
	+ kernel(f31(5),f31(12),8,-1) ...
	+ kernel(f31(6),f31(11),6,-1) ...
	+ kernel(f31(7),f31(10),4,-1) ...
	+ kernel(f31(8),f31(9),2,-1);
f43(:,4) = kernel(f32(1),0,1,1) ...
    + kernel(f32(6),0,1,1) ...
	+ kernel(f32(11),0,1,1) ...
	+ kernel(f32(2),f32(15),4,1) ...
	+ kernel(f32(5),f32(12),4,-1) ...
	+ kernel(f32(7),f32(10),4,1) ...
	+ kernel(f32(3),f32(14),7,1) ...
	+ kernel(f32(4),f32(13),7,-1) ...
	+ kernel(f32(8),f32(9),7,1);
f43(:,5) = kernel(f31(1),0,1,1) ...
    + kernel(f31(5),f31(12),2,1) ...
	+ kernel(f31(8),f31(9),3,-1) ...
	+ kernel(f31(4),f31(13),4,-1) ...
	+ kernel(f31(2),f31(15),5,1) ...
	+ kernel(f31(6),f31(11),6,1) ...
	+ kernel(f31(7),f31(10),7,-1) ...
	+ kernel(f31(3),f31(14),8,-1);
f43(:,6) = kernel(f32(1),0,1,1) ...
    + kernel(f32(4),0,1,1) ...
	+ kernel(f32(7),0,1,1) ...
    + kernel(f32(10),0,1,1) ...
	+ kernel(f32(13),0,1,1) ...
	+ kernel(f32(2),f32(15),6,1) ...
	+ kernel(f32(3),f32(14),6,-1) ...
	+ kernel(f32(5),f32(12),6,1) ...
	+ kernel(f32(6),f32(11),6,-1) ...
	+ kernel(f32(8),f32(9),6,1);
f43(:,7) = kernel(f31(1),0,1,1) ...
    + kernel(f31(6),0,1,1) ...
	+ kernel(f31(11),0,1,1) ...
	+ kernel(f31(3),f31(14),4,-1) ...
	+ kernel(f31(4),f31(13),4,1) ...
	+ kernel(f31(8),f31(9),4,-1) ...
	+ kernel(f31(2),f31(15),7,1) ...
	+ kernel(f31(5),f31(12),7,-1) ...
	+ kernel(f31(7),f31(10),7,1);
f43(:,8) = kernel(f32(1),0,1,1) ...
    + kernel(f32(3),f32(14),2,-1) ...
	+ kernel(f32(5),f32(12),3,-1) ...
    + kernel(f32(7),f32(10),4,-1) ...
	+ kernel(f32(8),f32(9),5,1) ...
	+ kernel(f32(6),f32(11),6,1) ...
	+ kernel(f32(4),f32(13),7,1) ...
	+ kernel(f32(2),f32(15),8,1);
f43(:,9) = kernel(f31(1),0,1,1) ...
    + kernel(f31(3),f31(14),2,1) ...
	+ kernel(f31(5),f31(12),3,1) ...
    + kernel(f31(7),f31(10),4,1) ...
	+ kernel(f31(8),f31(9),5,-1) ...
	+ kernel(f31(6),f31(11),6,-1) ...
	+ kernel(f31(4),f31(13),7,-1) ...
	+ kernel(f31(2),f31(15),8,-1);
f43(:,10) = kernel(f32(1),0,1,1) ...
    + kernel(f32(6),0,1,-1) ...
	+ kernel(f32(11),0,1,-1) ...
	+ kernel(f32(3),f32(14),4,1) ...
	+ kernel(f32(4),f32(13),4,-1) ...
	+ kernel(f32(8),f32(9),4,1) ...
	+ kernel(f32(2),f32(15),7,-1) ...
	+ kernel(f32(5),f32(12),7,1) ...
	+ kernel(f32(7),f32(10),7,-1);
%%
f51 = ([ ...
    t(0+1),t(15+1); t(16+1),t(1+1); t(2+1),t(17+1); ...
    t(18+1),t(3+1); t(4+1),t(19+1); t(20+1),t(5+1); ...
    t(6+1),t(21+1); t(22+1),t(7+1); t(8+1),t(23+1); ...
    t(24+1),t(9+1); t(10+1),t(25+1); t(26+1),t(11+1); ...
    t(12+1),t(27+1); t(28+1),t(13+1); t(14+1),t(29+1); ...
    ]);

f53 = zeros(4,8);

f53(:,1) = kernel4([f51(1,:),0,0],1,1) ...
    + kernel4([f51(2,:),0,0],1,1) ...
    + kernel4([f51(3,:),0,0],1,1) ...
    + kernel4([f51(4,:),0,0],1,1) ...
    + kernel4([f51(5,:),0,0],1,1) ...
    + kernel4([f51(6,:),0,0],1,1) ...
    + kernel4([f51(7,:),0,0],1,1) ...
    + kernel4([f51(8,:),0,0],1,1) ...
    + kernel4([f51(9,:),0,0],1,1) ...
    + kernel4([f51(10,:),0,0],1,1) ...
    + kernel4([f51(11,:),0,0],1,1) ...
    + kernel4([f51(12,:),0,0],1,1) ...
    + kernel4([f51(13,:),0,0],1,1) ...
    + kernel4([f51(14,:),0,0],1,1) ...
    + kernel4([f51(15,:),0,0],1,1);
%
f53(:,2) = kernel4([f51(1,:),0,0],1,1) ...
    + kernel4([f51(2,:),f51(15,:)],2,1) ...
	+ kernel4([f51(3,:),f51(14,:)],3,1) ...
	+ kernel4([f51(4,:),f51(13,:)],4,1) ...
	+ kernel4([f51(5,:),f51(12,:)],5,1) ...
	+ kernel4([f51(6,:),f51(11,:)],6,1) ...
	+ kernel4([f51(7,:),f51(10,:)],7,1) ...
	+ kernel4([f51(8,:),f51(9,:)],8,1);
%
f53(:,3) = kernel4([f51(1,:),0,0],1,1) ...
	+ kernel4([f51(8,:),f51(9,:)],2,-1) ...
    + kernel4([f51(2,:),f51(15,:)],3,1) ...
	+ kernel4([f51(7,:),f51(10,:)],4,-1) ...
	+ kernel4([f51(3,:),f51(14,:)],5,1) ...
	+ kernel4([f51(6,:),f51(11,:)],6,-1) ...
	+ kernel4([f51(4,:),f51(13,:)],7,1) ...
	+ kernel4([f51(5,:),f51(12,:)],8,-1);
%
f53(:,4) = kernel4([f51(1,:),0,0],1,1) ...
    + kernel4([f51(6,:),0,0],1,1) ...
	+ kernel4([f51(11,:),0,0],1,1) ...
	+ kernel4([f51(2,:),f51(15,:)],4,1) ...
	+ kernel4([f51(5,:),f51(12,:)],4,-1) ...
	+ kernel4([f51(7,:),f51(10,:)],4,1) ...
	+ kernel4([f51(3,:),f51(14,:)],7,1) ...
	+ kernel4([f51(4,:),f51(13,:)],7,-1) ...
	+ kernel4([f51(8,:),f51(9,:)],7,1);
%
f53(:,5) = kernel4([f51(1,:),0,0],1,1) ...
    + kernel4([f51(5,:),f51(12,:)],2,1) ...
	+ kernel4([f51(8,:),f51(9,:)],3,-1) ...
	+ kernel4([f51(4,:),f51(13,:)],4,-1) ...
	+ kernel4([f51(2,:),f51(15,:)],5,1) ...
	+ kernel4([f51(6,:),f51(11,:)],6,1) ...
	+ kernel4([f51(7,:),f51(10,:)],7,-1) ...
	+ kernel4([f51(3,:),f51(14,:)],8,-1);
%
f53(:,6) = kernel4([f51(1,:),0,0],1,1) ...
    + kernel4([f51(4,:),0,0],1,1) ...
	+ kernel4([f51(7,:),0,0],1,1) ...
    + kernel4([f51(10,:),0,0],1,1) ...
	+ kernel4([f51(13,:),0,0],1,1) ...
	+ kernel4([f51(2,:),f51(15,:)],6,1) ...
	+ kernel4([f51(3,:),f51(14,:)],6,-1) ...
	+ kernel4([f51(5,:),f51(12,:)],6,1) ...
	+ kernel4([f51(6,:),f51(11,:)],6,-1) ...
	+ kernel4([f51(8,:),f51(9,:)],6,1);
%7,10,22,25
f53(:,7) = kernel4([f51(1,:),0,0],1,1) ...
    + kernel4([f51(6,:),0,0],1,1) ...
	+ kernel4([f51(11,:),0,0],1,1) ...
	+ kernel4([f51(3,:),f51(14,:)],4,-1) ...
	+ kernel4([f51(4,:),f51(13,:)],4,1) ...
	+ kernel4([f51(8,:),f51(9,:)],4,-1) ...
	+ kernel4([f51(2,:),f51(15,:)],7,1) ...
	+ kernel4([f51(5,:),f51(12,:)],7,-1) ...
	+ kernel4([f51(7,:),f51(10,:)],7,1);
%8,9,23,24
f53(:,8) = kernel4([f51(1,:),0,0],1,1) ...
    + kernel4([f51(3,:),f51(14,:)],2,-1) ...
	+ kernel4([f51(5,:),f51(12,:)],3,-1) ...
    + kernel4([f51(7,:),f51(10,:)],4,-1) ...
	+ kernel4([f51(8,:),f51(9,:)],5,1) ...
	+ kernel4([f51(6,:),f51(11,:)],6,1) ...
	+ kernel4([f51(4,:),f51(13,:)],7,1) ...
	+ kernel4([f51(2,:),f51(15,:)],8,1)

f54 = zeros(1,30);
f54(1) = f53(1,1);
f54(2) = f53(3,2);
f54(3) = f53(1,3);
f54(4) = f53(3,4);
f54(5) = f53(1,5);
f54(6) = f53(3,6);
f54(7) = f53(1,7);
f54(8) = f53(3,8);
f54(9) = f53(2,8);
f54(10) = f53(4,7);
f54(11) = f53(2,6);
f54(12) = f53(4,5);
f54(13) = f53(2,4);
f54(14) = f53(4,3);
f54(15) = f53(2,2);
f54(16) = f53(3,1);
f54(17) = f53(1,2);
f54(18) = f53(3,3);
f54(19) = f53(1,4);
f54(20) = f53(3,5);
f54(21) = f53(1,6);
f54(22) = f53(3,7);
f54(23) = f53(1,8);
f54(24) = f53(4,8);
f54(25) = f53(2,7);
f54(26) = f53(4,6);
f54(27) = f53(2,5);
f54(28) = f53(4,4);
f54(29) = f53(2,3);
f54(30) = f53(4,2);

f54/256